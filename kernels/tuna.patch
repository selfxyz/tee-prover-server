From 8fda9baa5d7ce352defb4b896041d97999e7985d Mon Sep 17 00:00:00 2001
From: Roshan Raghupathy <thisisroshansmail@gmail.com>
Date: Mon, 29 Jul 2024 14:35:55 +0530
Subject: [PATCH] enable flags needed for the raw proxies

---
 kernel/microvm-kernel-config-aarch64 | 9 ++++++---
 kernel/microvm-kernel-config-x86_64  | 9 ++++++---
 2 files changed, 12 insertions(+), 6 deletions(-)

diff --git a/kernel/microvm-kernel-config-aarch64 b/kernel/microvm-kernel-config-aarch64
index c17f638..1537ed7 100644
--- a/kernel/microvm-kernel-config-aarch64
+++ b/kernel/microvm-kernel-config-aarch64
@@ -1118,7 +1118,7 @@ CONFIG_NETFILTER_SKIP_EGRESS=y
 CONFIG_NETFILTER_FAMILY_BRIDGE=y
 CONFIG_NETFILTER_BPF_LINK=y
 # CONFIG_NETFILTER_NETLINK_ACCT is not set
-# CONFIG_NETFILTER_NETLINK_QUEUE is not set
+CONFIG_NETFILTER_NETLINK_QUEUE=y
 # CONFIG_NETFILTER_NETLINK_LOG is not set
 # CONFIG_NETFILTER_NETLINK_OSF is not set
 CONFIG_NF_CONNTRACK=y
@@ -1175,9 +1175,10 @@ CONFIG_NETFILTER_XTABLES=y
 # CONFIG_NETFILTER_XT_TARGET_LOG is not set
 # CONFIG_NETFILTER_XT_TARGET_MARK is not set
 CONFIG_NETFILTER_XT_NAT=y
+CONFIG_NETFILTER_XT_SET=y
 CONFIG_NETFILTER_XT_TARGET_NETMAP=y
 # CONFIG_NETFILTER_XT_TARGET_NFLOG is not set
-# CONFIG_NETFILTER_XT_TARGET_NFQUEUE is not set
+CONFIG_NETFILTER_XT_TARGET_NFQUEUE=y
 # CONFIG_NETFILTER_XT_TARGET_RATEEST is not set
 CONFIG_NETFILTER_XT_TARGET_REDIRECT=y
 CONFIG_NETFILTER_XT_TARGET_MASQUERADE=y
@@ -1237,7 +1238,9 @@ CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
 # CONFIG_NETFILTER_XT_MATCH_U32 is not set
 # end of Core Netfilter Configuration
 
-# CONFIG_IP_SET is not set
+CONFIG_IP_SET=y
+CONFIG_IP_SET_BITMAP_PORT=y
+CONFIG_IP_SET_HASH_NET=y
 # CONFIG_IP_VS is not set
 
 #
diff --git a/kernel/microvm-kernel-config-x86_64 b/kernel/microvm-kernel-config-x86_64
index fc4f8d6..eae166d 100644
--- a/kernel/microvm-kernel-config-x86_64
+++ b/kernel/microvm-kernel-config-x86_64
@@ -1118,7 +1118,7 @@ CONFIG_NETFILTER_SKIP_EGRESS=y
 CONFIG_NETFILTER_FAMILY_BRIDGE=y
 CONFIG_NETFILTER_BPF_LINK=y
 # CONFIG_NETFILTER_NETLINK_ACCT is not set
-# CONFIG_NETFILTER_NETLINK_QUEUE is not set
+CONFIG_NETFILTER_NETLINK_QUEUE=y
 # CONFIG_NETFILTER_NETLINK_LOG is not set
 # CONFIG_NETFILTER_NETLINK_OSF is not set
 CONFIG_NF_CONNTRACK=y
@@ -1175,9 +1175,10 @@ CONFIG_NETFILTER_XTABLES=y
 # CONFIG_NETFILTER_XT_TARGET_LOG is not set
 # CONFIG_NETFILTER_XT_TARGET_MARK is not set
 CONFIG_NETFILTER_XT_NAT=y
+CONFIG_NETFILTER_XT_SET=y
 CONFIG_NETFILTER_XT_TARGET_NETMAP=y
 # CONFIG_NETFILTER_XT_TARGET_NFLOG is not set
-# CONFIG_NETFILTER_XT_TARGET_NFQUEUE is not set
+CONFIG_NETFILTER_XT_TARGET_NFQUEUE=y
 # CONFIG_NETFILTER_XT_TARGET_RATEEST is not set
 CONFIG_NETFILTER_XT_TARGET_REDIRECT=y
 CONFIG_NETFILTER_XT_TARGET_MASQUERADE=y
@@ -1237,7 +1238,9 @@ CONFIG_NETFILTER_XT_MATCH_CONNTRACK=y
 # CONFIG_NETFILTER_XT_MATCH_U32 is not set
 # end of Core Netfilter Configuration
 
-# CONFIG_IP_SET is not set
+CONFIG_IP_SET=y
+CONFIG_IP_SET_BITMAP_PORT=y
+CONFIG_IP_SET_HASH_NET=y
 # CONFIG_IP_VS is not set
 
 #
